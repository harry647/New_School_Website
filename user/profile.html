<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Profile | Bar Union Mixed Secondary School</title>
  <meta name="description" content="View and manage your profile, photo, activity, and account settings." />
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- Custom Premium CSS -->
<style>
/* ==================================================
   USER PROFILE PAGE – BAR UNION MIXED SECONDARY SCHOOL
   FINAL 2025–2026 ULTRA-PREMIUM EDITION
   Full photo upload • Stats • Activity • Mobile-perfect
================================================== */

:root {
  --blue: #0175C2;
  --blue-dark: #0b2d5e;
  --gold: #ffd700;
  --gold-light: #ffed4e;
  --gray: #555;
  --gray-light: #777;
  --light: #f8fafc;
  --radius: 32px;
  --shadow-sm: 0 12px 35px rgba(0,0,0,0.1);
  --shadow-md: 0 20px 50px rgba(0,0,0,0.15);
  --shadow-lg: 0 35px 80px rgba(0,0,0,0.22);
  --transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Inter', system-ui, sans-serif;
  background: linear-gradient(135deg, #f0f5ff 0%, #e0eaff 100%);
  color: #333;
  min-height: 100vh;
  padding-top: 90px;
}

/* ==================================
   Header Spacing (for fixed header)
================================== */
.container {
  max-width: 1380px;
  margin: 0 auto;
  padding: 0 1.5rem;
}

/* ==================================
   Profile Hero Card
================================== */
.profile-card {
  background: white;
  border-radius: 42px;
  padding: 4rem 5rem;
  margin: 4rem auto;
  max-width: 1100px;
  box-shadow: var(--shadow-lg);
  border: 1px solid rgba(1,117,194,0.15);
  position: relative;
  overflow: hidden;
}
.profile-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 12px;
  background: linear-gradient(90deg, var(--blue-dark), var(--blue), var(--gold));
  border-radius: 42px 42px 0 0;
}

/* Profile Header */
.profile-header {
  display: flex;
  align-items: center;
  gap: 3rem;
  margin-bottom: 3rem;
  flex-wrap: wrap;
}
.profile-photo-wrapper {
  position: relative;
}
#userPhoto {
  width: 180px;
  height: 180px;
  object-fit: cover;
  border-radius: 50%;
  border: 8px solid white;
  box-shadow: 0 20px 50px rgba(0,0,0,0.25);
  transition: var(--transition);
}
.profile-photo-wrapper:hover #userPhoto {
  transform: scale(1.08);
}
#photoUpload {
  position: absolute;
  bottom: 10px; right: 10px;
  width: 50px; height: 50px;
  background: var(--blue);
  color: white;
  border-radius: 50%;
  display: grid;
  place-items: center;
  font-size: 1.4rem;
  cursor: pointer;
  box-shadow: 0 10px 30px rgba(1,117,194,0.4);
  transition: var(--transition);
}
#photoUpload:hover {
  background: var(--blue-dark);
  transform: scale(1.15);
}

.profile-info h1 {
  font-family: 'Playfair Display', serif;
  font-size: 3.2rem;
  font-weight: 900;
  color: var(--blue-dark);
  margin: 0 0 0.8rem;
}
.profile-info .role {
  font-size: 1.4rem;
  color: var(--blue);
  font-weight: 700;
  margin-bottom: 1rem;
}
.profile-info p {
  font-size: 1.2rem;
  color: var(--gray);
  line-height: 1.9;
}

/* ==================================
   Stats Grid
================================== */
.profile-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2.5rem;
  margin: 4rem 0;
}
.stat-item {
  background: rgba(1,117,194,0.08);
  padding: 2.5rem;
  border-radius: 28px;
  text-align: center;
  transition: var(--transition);
}
.stat-item:hover {
  background: rgba(1,117,194,0.15);
  transform: translateY(-10px);
}
.stat-item i {
  font-size: 3rem;
  color: var(--blue);
  margin-bottom: 1.2rem;
}
.stat-item strong {
  display: block;
  font-size: 2.8rem;
  font-weight: 900;
  color: var(--blue-dark);
}
.stat-item span {
  font-size: 1.1rem;
  color: var(--gray);
}

/* ==================================
   Activity & Actions
================================== */
.profile-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
  margin: 4rem 0;
  justify-content: center;
}
.profile-actions .btn {
  padding: 1.4rem 4rem;
  font-size: 1.2rem;
  font-weight: 700;
  border-radius: 70px;
  transition: var(--transition);
  min-width: 220px;
  text-align: center;
}
.btn-primary {
  background: linear-gradient(135deg, var(--blue-dark), var(--blue));
  color: white;
  box-shadow: 0 15px 45px rgba(1,117,194,0.4);
}
.btn-primary:hover {
  transform: translateY(-10px);
  box-shadow: 0 25px 70px rgba(1,117,194,0.55);
}
.btn-outline {
  background: white;
  color: var(--blue-dark);
  border: 2px solid var(--blue);
}
.btn-outline:hover {
  background: var(--blue);
  color: white;
}

/* ==================================
   Recent Activity
================================== */
.activity-feed {
  background: white;
  border-radius: var(--radius);
  padding: 3.5rem;
  box-shadow: var(--shadow-md);
  margin: 4rem 0;
}
.activity-feed h3 {
  font-family: 'Playfair Display', serif;
  font-size: 2.4rem;
  color: var(--blue-dark);
  margin-bottom: 2rem;
  text-align: center;
}
.activity-item {
  display: flex;
  align-items: flex-start;
  gap: 1.5rem;
  padding: 1.5rem 0;
  border-bottom: 1px dashed rgba(1,117,194,0.15);
}
.activity-item:last-child {
  border-bottom: none;
}
.activity-item i {
  font-size: 2rem;
  color: var(--blue);
  min-width: 50px;
}
.activity-item .content h5 {
  font-size: 1.3rem;
  color: var(--blue-dark);
  margin: 0 0 0.5rem;
}
.activity-item .content p {
  font-size: 1.05rem;
  color: var(--gray);
  margin: 0;
}
.activity-time {
  font-size: 0.95rem;
  color: var(--gray-light);
  margin-top: 0.5rem;
}

/* ==================================
   RESPONSIVE – FLAWLESS
================================== */
@media (max-width: 992px) {
  .profile-header {
    flex-direction: column;
    text-align: center;
  }
  #userPhoto {
    width: 160px;
    height: 160px;
  }
}
@media (max-width: 768px) {
  .profile-card {
    padding: 3.5rem 3rem;
  }
  .profile-stats {
    grid-template-columns: 1fr 1fr;
  }
}
@media (max-width: 640px) {
  .profile-card {
    padding: 3rem 2rem;
    border-radius: 32px;
  }
  .profile-actions .btn {
    width: 100%;
  }
  .activity-feed {
    padding: 2.5rem;
  }
}
</style>
</head>
<body class="page-profile">

<div class="container">

  <!-- Main Profile Card -->
  <div class="profile-card">
    <div class="profile-header">
      <div class="profile-photo-wrapper">
        <img id="userPhoto" src="/assets/images/defaults/default-user.png" alt="Your Profile Photo">
        <label for="photoInput" id="photoUpload">
          <i class="fas fa-camera"></i>
          <input type="file" id="photoInput" accept="image/*" style="display:none;">
        </label>
      </div>
      <div class="profile-info">
        <h1 id="userName">Loading...</h1>
        <p class="role" id="userRole">Student • Form 3 Blue</p>
        <p id="userEmail">Loading...</p>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="profile-stats">
      <div class="stat-item">
        <i class="fas fa-trophy"></i>
        <strong id="achievementsCount">12</strong>
        <span>Achievements</span>
      </div>
      <div class="stat-item">
        <i class="fas fa-calendar-check"></i>
        <strong id="attendanceRate">98%</strong>
        <span>Attendance</span>
      </div>
      <div class="stat-item">
        <i class="fas fa-star"></i>
        <strong id="pointsEarned">850</strong>
        <span>Merit Points</span>
      </div>
      <div class="stat-item">
        <i class="fas fa-users"></i>
        <strong id="clubsJoined">3</strong>
        <span>Clubs Active</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="profile-actions">
      <a href="/user/edit-profile.html" class="btn btn-primary">Edit Profile</a>
      <a href="/portal/dashboard.html" class="btn btn-outline">Go to Dashboard</a>
      <button class="btn btn-outline" onclick="alert('Password change coming soon!')">Change Password</button>
    </div>

    <!-- Recent Activity -->
    <div class="activity-feed">
      <h3>Recent Activity</h3>
      <div class="activity-item">
        <i class="fas fa-trophy"></i>
        <div class="content">
          <h5>Won 1st Place in Science Fair</h5>
          <p>Congratulations! Your project on renewable energy impressed the judges.</p>
          <div class="activity-time">2 days ago</div>
        </div>
      </div>
      <div class="activity-item">
        <i class="fas fa-star"></i>
        <div class="content">
          <h5>Earned 50 Merit Points</h5>
          <p>For excellent performance in Mathematics mid-term exam.</p>
          <div class="activity-time">1 week ago</div>
        </div>
      </div>
      <div class="activity-item">
        <i class="fas fa-users"></i>
        <div class="content">
          <h5>Joined Robotics Club</h5>
          <p>Welcome to the team! First meeting this Friday.</p>
          <div class="activity-time">2 weeks ago</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts – ULTRA-PREMIUM PROFILE.JS (2025–2026) -->
<script>
// =================================================================
// 1. PHOTO UPLOAD – Live Preview + Upload to Server
// =================================================================
document.getElementById('photoInput').addEventListener('change', async function(e) {
  const file = e.target.files[0];
  if (!file) return;

  // 1. Show instant preview
  const reader = new FileReader();
  reader.onload = (e) => {
    document.getElementById('userPhoto').src = e.target.result;
  };
  reader.readAsDataURL(file);

  // 2. Upload to server
  const formData = new FormData();
  formData.append('photo', file);

  try {
    const res = await fetch('/api/profile', {
      method: 'PUT',
      body: formData,
      credentials: 'include'
    });
    const data = await res.json();
    if (data.success) {
      showToast('Profile photo updated successfully!', 'success');
    } else {
      showToast('Failed to update photo. Please try again.', 'error');
    }
  } catch (err) {
    console.error('Upload error:', err);
    showToast('Network error. Please check your connection.', 'error');
  }
});

// =================================================================
// 2. LOAD PROFILE FROM API (Real Data)
// =================================================================
async function loadProfile() {
  const loadingElements = document.querySelectorAll('#userName, #userEmail, #userRole, .stat-item strong');
  loadingElements.forEach(el => el.textContent = 'Loading...');

  try {
    const res = await fetch('/api/profile', {
      credentials: 'include'
    });
    const data = await res.json();

    if (!data.success || !data.user) {
      window.location.href = '/user/login.html';
      return;
    }

    const user = data.user;

    // Populate profile
    document.getElementById('userName').textContent = user.name || 'Student';
    document.getElementById('userEmail').textContent = user.email || 'No email';
    document.getElementById('userRole').textContent = `${user.role || 'Student'} • ${user.grade || 'N/A'}`;
    document.getElementById('userPhoto').src = user.photo || '/assets/images/defaults/default-user.png';

    // Stats (fallback to 0 if not available)
    document.getElementById('achievementsCount').textContent = user.achievements || '0';
    document.getElementById('attendanceRate').textContent = user.attendance || '0%';
    document.getElementById('pointsEarned').textContent = user.points || '0';
    document.getElementById('clubsJoined').textContent = user.clubs?.length || '0';

  } catch (err) {
    console.error('Profile load error:', err);
    showToast('Failed to load profile. Redirecting...', 'error');
    setTimeout(() => window.location.href = '/user/login.html', 2000);
  }
}

// =================================================================
// 3. TOAST NOTIFICATIONS – Beautiful Feedback
// =================================================================
function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.textContent = message;
  toast.style.cssText = `
    position: fixed;
    bottom: 30px; right: 30px;
    background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#1e40af'};
    color: white;
    padding: 1.2rem 2rem;
    border-radius: 16px;
    font-weight: 600;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    z-index: 9999;
    animation: slideIn 0.5s ease, fadeOut 0.5s ease 3s forwards;
    transform: translateX(120%);
  `;
  document.body.appendChild(toast);

  // Trigger animation
  setTimeout(() => toast.style.transform = 'translateX(0)', 100);

  // Auto remove
  setTimeout(() => toast.remove(), 4000);
}

// Animation keyframes
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn { from { transform: translateX(120%); } to { transform: translateX(0); } }
  @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
`;
document.head.appendChild(style);

// =================================================================
// 4. INIT – Load Profile on Page Load
// =================================================================
document.addEventListener('DOMContentLoaded', () => {
  loadProfile();
});
</script>

</body>
</html>